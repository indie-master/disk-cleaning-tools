# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–ª–µ–π–±—É–∫ –æ—á–∏—Å—Ç–∫–∏ –¥–∏—Å–∫–∞

–ü—Ä–∞–∫—Ç–∏—á–Ω—ã–π runbook –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞ –Ω–∞ Linux VPS –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–±–æ—á–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Docker, systemd-journald, Snap, APT).

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [A) –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è / –¥–ª—è —á–µ–≥–æ —ç—Ç–æ](#a-–æ–±–ª–∞—Å—Ç—å-–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è--–¥–ª—è-—á–µ–≥–æ-—ç—Ç–æ)
- [B) –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç: —á—Ç–æ –æ–±—ã—á–Ω–æ —Å—ä–µ–¥–∞–µ—Ç –¥–∏—Å–∫](#b-–±—ã—Å—Ç—Ä—ã–π-—á–µ–∫–ª–∏—Å—Ç-—á—Ç–æ-–æ–±—ã—á–Ω–æ-—Å—ä–µ–¥–∞–µ—Ç-–¥–∏—Å–∫)
- [C) –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è)](#c-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–±–µ–∑-—É–¥–∞–ª–µ–Ω–∏—è)
- [D) –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —à–∞–≥–∏ –æ—á–∏—Å—Ç–∫–∏](#d-–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ-—à–∞–≥–∏-–æ—á–∏—Å—Ç–∫–∏)
- [E) –§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç](#e-—Ñ–∏–Ω–∞–ª—å–Ω—ã–π-–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π-—á–µ–∫–ª–∏—Å—Ç)
- [F) –û–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π)](#f-–æ–ø–∞—Å–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å-—Ç–æ–ª—å–∫–æ-–ø—Ä–∏-–ø–æ–ª–Ω–æ–º-–ø–æ–Ω–∏–º–∞–Ω–∏–∏-–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π)
- [G) –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ / –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –¥–∏—Å–∫–∞](#g-–ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞--–ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ-–∑–¥–æ—Ä–æ–≤—å—è-–¥–∏—Å–∫–∞)
- [H) –ú–∏–Ω–∏-—Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ–¥–Ω–∏–º –∑–∞–ø—É—Å–∫–æ–º](#h-–º–∏–Ω–∏-—Å–∫—Ä–∏–ø—Ç-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏-–æ–¥–Ω–∏–º-–∑–∞–ø—É—Å–∫–æ–º)
- [I) –¶–µ–ª–µ–≤—ã–µ –∑–¥–æ—Ä–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏](#i-—Ü–µ–ª–µ–≤—ã–µ-–∑–¥–æ—Ä–æ–≤—ã–µ-–º–µ—Ç—Ä–∏–∫–∏)

## A) –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è / –¥–ª—è —á–µ–≥–æ —ç—Ç–æ
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –Ω–∞ Linux VPS (Ubuntu/Debian) –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ –∏ –Ω—É–∂–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ, –æ–±—Ä–∞—Ç–∏–º—ã–µ —à–∞–≥–∏ –æ—á–∏—Å—Ç–∫–∏. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ö–æ—Å—Ç–æ–≤ —Å Docker, systemd-journald, –∞ —Ç–∞–∫–∂–µ —Å Snap –∏ APT.

## B) –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç: —á—Ç–æ –æ–±—ã—á–Ω–æ —Å—ä–µ–¥–∞–µ—Ç –¥–∏—Å–∫ ‚úÖ
- Docker-–æ–±—Ä–∞–∑—ã, —Å–ª–æ–∏ –∏ build cache.
- –õ–æ–≥–∏ journald –≤ `/var/log/journal`.
- –ö—ç—à APT –∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã.
- –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ä–µ–≤–∏–∑–∏–∏ Snap.
- –ö—Ä—É–ø–Ω—ã–µ –ª–æ–≥–∏ –≤ `/var/log` (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, nginx, –ë–î).

## C) –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è)
–°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏.

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º

df -h
lsblk -f

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è (–≤ —Ä–∞–º–∫–∞—Ö —Ç–æ–π –∂–µ –§–°)

du -xhd1 /
du -xhd1 /var
du -xhd1 /var/lib

# –ù–∞–π—Ç–∏ –∫—Ä—É–ø–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ /var

find /var -type f -size +200M -print

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

if command -v docker >/dev/null 2>&1; then
  docker system df -v
else
  echo "docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ journald

journalctl --disk-usage
```

## D) –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —à–∞–≥–∏ –æ—á–∏—Å—Ç–∫–∏
–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –ø–æ –ø–æ—Ä—è–¥–∫—É, –ø—Ä–æ–≤–µ—Ä—è—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã.

### 1) Docker-–æ–±—Ä–∞–∑—ã –∏ build cache üßπ
```bash
# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ (dangling) –æ–±—Ä–∞–∑—ã

docker image prune -f

# –£–¥–∞–ª–∏—Ç—å –∫—ç—à —Å–±–æ—Ä–æ–∫

docker builder prune -f
```

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
df -h
if command -v docker >/dev/null 2>&1; then
  docker system df
else
  echo "docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi
journalctl --disk-usage
```

### 2) Vacuum –¥–ª—è journald
```bash
# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ª–æ–≥–∏ –ø–æ —Ä–∞–∑–º–µ—Ä—É

journalctl --vacuum-size=200M

# –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π

journalctl --vacuum-time=7d
```

‚ö†Ô∏è –ù–µ —Ç—Ä–æ–≥–∞–π—Ç–µ `/var/log/journal` (—ç—Ç–æ –∫–∞—Ç–∞–ª–æ–≥). –î–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `journalctl`.

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
df -h
if command -v docker >/dev/null 2>&1; then
  docker system df
else
  echo "docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi
journalctl --disk-usage
```

### 3) –û—á–∏—Å—Ç–∫–∞ APT
```bash
apt-get clean
apt-get autoclean
apt-get autoremove --purge -y
```

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
df -h
if command -v docker >/dev/null 2>&1; then
  docker system df
else
  echo "docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi
journalctl --disk-usage
```

### 4) –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ä–µ–≤–∏–∑–∏–∏ Snap
```bash
# –£–¥–∞–ª–∏—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ä–µ–≤–∏–∑–∏–∏ snap

snap list --all | awk '/disabled/{print $1, $3}' | while read -r snapname revision; do
  snap remove "$snapname" --revision="$revision"
done
```

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
df -h
if command -v docker >/dev/null 2>&1; then
  docker system df
else
  echo "docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi
journalctl --disk-usage
```

### 5) /var/log: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ç–æ—á–µ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
```bash
# –ù–∞–π—Ç–∏ –∫—Ä—É–ø–Ω—ã–µ –ª–æ–≥–∏

du -sh /var/log/* | sort -h

# –ü—Ä–∏–º–µ—Ä: –æ–±–Ω—É–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–æ–ª—å—à–æ–π –ª–æ–≥

truncate -s 0 /var/log/your-app.log

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å logrotate –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

logrotate -f /etc/logrotate.conf
```

‚ö†Ô∏è –û–±–Ω—É–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –±–æ–ª—å—à–∏–µ –ª–æ–≥-—Ñ–∞–π–ª—ã. –ù–µ —É–¥–∞–ª—è–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –ª–æ–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã —Å–µ—Ä–≤–∏—Å–∞–º.

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
df -h
if command -v docker >/dev/null 2>&1; then
  docker system df
else
  echo "docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi
journalctl --disk-usage
```

## E) –§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç ‚úÖ
- –°–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç (Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ–∫—Å–∏).
- –î–∏—Å–∫ –Ω–∏–∂–µ —Ü–µ–ª–µ–≤—ã—Ö –ø–æ—Ä–æ–≥–æ–≤.
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ –∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —É–¥–∞–ª–µ–Ω—ã.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ journald —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ—Å–ª–µ vacuum.

## F) –û–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π) ‚ö†Ô∏è
–≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –º–æ–≥—É—Ç —É–¥–∞–ª–∏—Ç—å –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

```bash
# –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –æ–±—Ä–∞–∑—ã, –≤–∫–ª—é—á–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ–≥–∏

docker system prune -a

# –£–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–æ–º–∞ (–º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ)

docker system prune --volumes

# –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ Docker –Ω–∞ —Ö–æ—Å—Ç–µ

rm -rf /var/lib/docker
```

## G) –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ / –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –¥–∏—Å–∫–∞
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ journald –≤ `/etc/systemd/journald.conf`:
  - `SystemMaxUse=200M`
  - `RuntimeMaxUse=50M`
- –ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ journald:

```bash
systemctl restart systemd-journald
```

- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–∑–º–µ—Ä—ã Docker JSON-–ª–æ–≥–æ–≤ (`/var/lib/docker/containers/*/*-json.log`).

## H) –ú–∏–Ω–∏-—Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ–¥–Ω–∏–º –∑–∞–ø—É—Å–∫–æ–º
```bash
#!/usr/bin/env bash
set -euo pipefail

echo "## df -h"
df -h

echo "## lsblk -f"
lsblk -f

echo "## du -xhd1 /"
du -xhd1 /

echo "## du -xhd1 /var"
du -xhd1 /var

echo "## du -xhd1 /var/lib"
du -xhd1 /var/lib

echo "## find /var -size +200M"
find /var -type f -size +200M -print

echo "## docker system df -v"
if command -v docker >/dev/null 2>&1; then
  docker system df -v
else
  echo "docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi

echo "## journalctl --disk-usage"
journalctl --disk-usage
```

## I) –¶–µ–ª–µ–≤—ã–µ –∑–¥–æ—Ä–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ üìå
- –ö–æ—Ä–Ω–µ–≤–∞—è –§–° (`/`) –Ω–∏–∂–µ 80% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
- Journald –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 50‚Äì200 MB.
- Docker –±–µ–∑ –ª–∏—à–Ω–∏—Ö dangling-–æ–±—Ä–∞–∑–æ–≤ –∏ –∫–µ—à–∞ —Å–±–æ—Ä–æ–∫.
- –ù–µ—Ç –ª–æ–≥–æ–≤, —Ä–∞—Å—Ç—É—â–∏—Ö –∞–Ω–æ–º–∞–ª—å–Ω–æ.
